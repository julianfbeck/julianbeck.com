---
import { SITE } from "../../../config.mjs";
import { fetchApps, type DetailedApp, proseCSS } from "../../helpers/apps";
import Layout from "../../layouts/PageLayout.astro";
import { Image } from "astro:assets";

export async function getStaticPaths() {
  const apps = await fetchApps();

  return apps.map((app) => ({
    params: {
      slug: app.slug,
    },
    props: {
      app,
    },
  }));
}

interface Props {
  app: DetailedApp;
}

const { app } = Astro.props;
const meta = {
  title: `${app.data.title} â€” ${SITE.name}`,
  description: app.data.description,
  image: app.icon,
  ogTitle: app.data.title,
  ogType: "product",
  appStoreId: app.data.appStoreId || "",
};
---

<Layout {meta}>
  <section class="max-w-3xl py-8 sm:py-16 lg:py-20 mx-auto lg:-mt-10 mb-10">
    <article>
      <header class="flex flex-col items-center text-center px-4 sm:px-6 mb-40">
        <img
          src={app.icon}
          width="224"
          height="224"
          class={`mb-3 rounded-[44px]`}
        />
        <h1
          class="text-5xl md:text-6xl font-bold leading-tighter tracking-tighter mb-4 font-heading text-white"
        >
          {app.data.title}
        </h1>
        <h2 class="text-2xl md:text-3xl tracking-tight mb-8 text-white">
          {app.data.description}
        </h2>
        <>
          {
            app.data.isIOSApp && app.data.appStoreId && (
              <div class="relative">
                <a href={app.appstoreUrl}>
                  <img
                    src="/base/download-on-app-store-badge.svg"
                    alt="Download on the App Store"
                    style="margin: 0; padding: 0; display: block; height: 60px; user-select: none"
                  />
                </a>
              </div>
            )
          }
        </>
        {
          Object.keys(app.data.links || {}).length > 0 && (
            <nav class="flex flex-wrap gap-4 max-w-md justify-center mt-8 font-semibold text-xl text-primary-600 instapaper_ignore">
              <>
                {Object.entries(app.data.links || {}).map(([title, url]) => (
                  <a
                    href={url}
                    class="hover:text-primary-400 dark:text-primary-400 dark:hover:text-primary-200"
                  >
                    {title}
                  </a>
                ))}
              </>
            </nav>
          )
        }
      </header>
    </article>
    <div class={proseCSS}>
      <app.Content />
      <section class="mb-20">
        {
          app.screenshots.map((screenshot) => (
            <Image
              src={screenshot}
              alt="Picture of the app"
              inferSize
              loading="lazy"
              decoding="async"
              widths={[240, 540, 720]}
              sizes={`(max-width: 360px) 240px, (max-width: 720px) 540px, (max-width: 1600px) 720px`}
            />
          ))
        }
      </section>
    </div>
  </section>
</Layout>
