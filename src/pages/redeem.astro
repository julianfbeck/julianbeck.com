---
import { SITE_TITLE, SITE_DESCRIPTION } from "../consts";
import PageLayout from "../layouts/PageLayout.astro";

const meta = {
  title: `${SITE_TITLE} - Redeem Lifetime Codes`,
  description: "Redeem your lifetime plan codes for Julian Beck's apps",
};
---

<PageLayout meta={meta}>
  <div class="max-w-2xl mx-auto">
    <h1
      class="text-center text-4xl md:text-6xl font-bold leading-tighter tracking-tighter mb-8 md:mb-16 font-heading text-blue-100"
    >
      Redeem
      <span
        class="bg-clip-text text-transparent bg-gradient-to-r from-blue-300 to-red-500 pr-[0.025em] mr-[-0.025em]"
        >Lifetime Codes</span
      >
    </h1>
    
    <div class="bg-slate-800 rounded-lg p-8 shadow-lg">
      <p class="text-gray-300 mb-6 text-center">
        Enter your redemption code below to unlock lifetime access to premium features.
      </p>
      
      <form id="redeemForm" class="space-y-6">
        <div>
          <label for="email" class="block text-sm font-medium text-gray-300 mb-2">
            Email Address
          </label>
          <input
            type="email"
            id="email"
            name="email"
            required
            class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            placeholder="your@email.com"
          />
        </div>
        
        <div>
          <label for="code" class="block text-sm font-medium text-gray-300 mb-2">
            Redemption Code
          </label>
          <input
            type="text"
            id="code"
            name="code"
            required
            class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent uppercase tracking-wider"
            placeholder="XXXX-XXXX-XXXX-XXXX"
            maxlength="19"
          />
        </div>
        
        <div>
          <label for="app" class="block text-sm font-medium text-gray-300 mb-2">
            Select App
          </label>
          <select
            id="app"
            name="app"
            required
            class="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          >
            <option value="">Choose an app...</option>
            <option value="iemoji">iEmoji - AI Emoji Generator</option>
            <option value="localpdf">LocalPDF</option>
            <option value="openpoll">OpenPoll</option>
            <option value="glance-gitlab">Glance for GitLab</option>
            <option value="whatstats">WhatStats</option>
            <option value="gym-tracker">Gym Body Tracker</option>
            <option value="score-tracker">Score Tracker Pro</option>
            <option value="pi-stock">Pi Stock</option>
            <option value="coffee-tracker">Coffee Bean Tracker</option>
          </select>
        </div>
        
        <button
          type="submit"
          class="w-full bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-bold py-3 px-6 rounded-md transition duration-200 transform hover:scale-105"
        >
          Redeem Code
        </button>
      </form>
      
      <div id="message" class="mt-6 p-4 rounded-md hidden"></div>
      
      <div class="mt-8 pt-6 border-t border-slate-600">
        <h3 class="text-lg font-semibold text-white mb-3">Need Help?</h3>
        <ul class="text-gray-300 space-y-2 text-sm">
          <li>• Codes are case-insensitive and will be automatically formatted</li>
          <li>• Each code can only be redeemed once per email address</li>
          <li>• If you're having issues, contact <a href="mailto:mail@julianbeck.com" class="text-blue-400 hover:text-blue-300">mail@julianbeck.com</a></li>
          <li>• Lifetime access includes all current and future premium features</li>
        </ul>
      </div>
    </div>
  </div>
</PageLayout>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('redeemForm') as HTMLFormElement;
    const codeInput = document.getElementById('code') as HTMLInputElement;
    const messageDiv = document.getElementById('message') as HTMLDivElement;
    
    // Format code input as user types
    codeInput.addEventListener('input', function(e) {
      const target = e.target as HTMLInputElement;
      let value = target.value.replace(/[^A-Za-z0-9]/g, '').toUpperCase();
      
      // Add dashes every 4 characters
      if (value.length > 0) {
        value = value.match(/.{1,4}/g)?.join('-') || value;
      }
      
      target.value = value;
    });
    
    form.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const formData = new FormData(form);
      const email = formData.get('email') as string;
      const code = formData.get('code') as string;
      const app = formData.get('app') as string;
      
      // Show loading state
      const submitButton = form.querySelector('button[type="submit"]') as HTMLButtonElement;
      const originalText = submitButton.textContent;
      submitButton.textContent = 'Redeeming...';
      submitButton.disabled = true;
      
      try {
        // Simulate API call (replace with actual endpoint)
        await new Promise(resolve => setTimeout(resolve, 2000));
        
        // For demo purposes, show success message
        showMessage('success', `Code successfully redeemed! Lifetime access to ${app} has been activated for ${email}. Check your email for confirmation.`);
        form.reset();
        
      } catch (error) {
        showMessage('error', 'Failed to redeem code. Please check your code and try again.');
      } finally {
        submitButton.textContent = originalText;
        submitButton.disabled = false;
      }
    });
    
    function showMessage(type: 'success' | 'error', text: string) {
      messageDiv.className = `mt-6 p-4 rounded-md ${
        type === 'success' 
          ? 'bg-green-900 border border-green-700 text-green-100' 
          : 'bg-red-900 border border-red-700 text-red-100'
      }`;
      messageDiv.textContent = text;
      messageDiv.classList.remove('hidden');
      
      // Auto-hide after 5 seconds
      setTimeout(() => {
        messageDiv.classList.add('hidden');
      }, 5000);
    }
  });
</script>